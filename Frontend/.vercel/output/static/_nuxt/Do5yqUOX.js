var g=Object.defineProperty;var p=(t,e,r)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var s=(t,e,r)=>p(t,typeof e!="symbol"?e+"":e,r);import"./BN3SMaRa.js";import"./DLbQifwJ.js";import{E as u}from"./BXdRk_-m.js";import{k as f,p as w,I as k,O as h}from"./logkf7nQ.js";var m=(t=>(t.teacher="teacher",t.student="student",t.Admin="admin",t))(m||{});class A{constructor(e={}){s(this,"_id");s(this,"username");s(this,"email");s(this,"password");s(this,"role");s(this,"createdAt");var r,o,i,n,a;this._id=e._id||"",this.role=e.role??m.student,this.username=((r=e.username)==null?void 0:r.trim())??"",this.email=(o=e.email)==null?void 0:o.trim(),this.password=(i=e.password)==null?void 0:i.trim(),this.createdAt=((n=e.created_at)==null?void 0:n.trim())||((a=e.createdAt)==null?void 0:a.trim())||void 0}toDict(e=!1){const r={role:this.role,username:this.username};return this._id&&(r._id=this._id),this.email&&(r.email=this.email),this.createdAt&&(r.created_at=this.createdAt),e&&this.password&&(r.password=this.password),r}}var S=(t=>(t.Admin="admin",t.Teacher="teacher",t.Student="student",t))(S||{});class T{constructor(){s(this,"$api",f().$api);s(this,"router",w());s(this,"config",k());s(this,"baseURL","/api/auth/")}async login(e){var r,o,i,n;if(!e.username||!e.password){u.warning("Please fill in all fields");return}try{const a=await this.$api.post(`${this.baseURL}login`,e);if(!(a!=null&&a.data)){u.error("No data from server");return}const l=(o=(r=a.data)==null?void 0:r.data)==null?void 0:o.user,c=(n=(i=a.data)==null?void 0:i.data)==null?void 0:n.access_token;if(console.log(l,c),!l||!c){u.error("Invalid response from server");return}h().login(c,l);const d=new A(l);console.log("Logged in user:",d.toDict()),this.redirectByRole(d.role)}catch(a){console.error("Login failed",a),u.error("Login failed, please try again")}}loginWithGoogle(){window.location.href=`${this.config.public.apiBase}/auth/google/login`}logout(){const e=h();this.clearToken(),e.logout(),this.router.push("/auth/login"),u.success("Logged out successfully")}getToken(){return localStorage.getItem("token")}storeToken(e){localStorage.setItem("token",e)}clearToken(){localStorage.removeItem("token")}redirectByRole(e){switch(e){case"admin":this.router.push("/admin/dashboard");break;case"teacher":this.router.push("/teacher/dashboard");break;default:this.router.push("/student/dashboard")}}}export{T as A,A as U,S as a};
